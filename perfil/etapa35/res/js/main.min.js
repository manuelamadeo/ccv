function getWidth(){return $jAlbum("#Embeddable").width()}function getHeight(){return $jAlbum(window).height()}function isMobile(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))}function previousDir(e){var t=e.split("/").pop();return e=e.substring(0,e.lastIndexOf("/")),e=e.substring(0,e.lastIndexOf("/")+1),e+t}function nextDir(e,t){var n=e.split("/").pop();return e=e.substring(0,e.lastIndexOf("/")+1),e+t+"/"+n}function getImageHTML(e,t,n){var i=$jAlbum("<img>",{id:e});return i.attr("src",t),i.css("position","absolute"),i}function getNumImgsInRow(e){var t=Math.round(e/currentBoxSize);return 1>t?1:t>window.maxImgInRow?window.maxImgInRow:t}function setImageBoxSize(e){$jAlbum(".main-box").css("width",e+"px"),$jAlbum(".main-box").css("height",e+"px"),$jAlbum(".wrapper-box").css("width",e+"px"),$jAlbum(".wrapper-box").css("height",e+"px")}function truncate(e,t){return e.length>t?e.substring(0,t)+"...":e}function initContent(e){var t=0;$jAlbum.each(e.objects,function(e,n){switch(n.category){case"folder":if(!n.objects)break;folders[t]={index:t,name:n.name,path:n.thumb.path,width:n.thumb.width,height:n.thumb.height,count:n.deepCounters.images},initFolder(t,n),t++}});var n=0;$jAlbum.each(e.objects,function(e,t){switch(t.category){case"image":thumbs[n]={index:n,path:t.thumb.path,width:t.thumb.width,height:t.thumb.height},slides[n]={index:n,category:t.category,path:t.image.path,width:t.image.width,height:t.image.height},initImage(n,t),n++}}),arrange()}function arrange(){for(var e,t,n,i,o,r,a,s,c=0;2>c;c++)e=getWidth(),t=getHeight(),n=.025*e,i=t-2*n,$jAlbum("#jAlbum-content").css("padding",""+n+"px 2.5%"),o=e-.05*e-.5,s=getNumImgsInRow(o),r=o/s,a=r-currentImgBoxPadding,setImageBoxSize(r);arrangeFolders(r,a),arrangeImages(r,a)}function back(){if(""!==currentPath){currentPath=previousDir(currentPath);var e=getJsonObject(window.album,currentPath);clearUpContent(),initContent(e),arrange()}}function triggerClearUp(e){var t=$jAlbum.Event("clearUpContent");t.state=e,$jAlbum(window).trigger(t)}function clearUpContent(){triggerClearUp(),folders=new Array,slides=new Array,thumbs=new Array,""==currentPath?$jAlbum(".leaveFolder").hide():$jAlbum(".leaveFolder").show()}function getJsonObject(e,t){var n=t.substring(0,t.indexOf("/")),i=t.substring(t.indexOf("/")+1,t.length);return""==n?e:(objectToReturn=void 0,$jAlbum.each(e.objects,function(e,t){switch(t.category){case"folder":t.path==n&&(objectToReturn=t)}}),getJsonObject(objectToReturn,i))}function initFolder(e,t){function n(){currentPath=nextDir(currentPath,t.path),clearUpContent(),initContent(t)}var i=$jAlbum("<div>",{"class":"main-box"}),o=$jAlbum("<div>",{"class":"wrapper-box"}),r=$jAlbum("<div>",{"class":"text-box"}),a=0;if(o.attr("id","test-box-"+e),o.css({"-webkit-transition":"0.2s ease-out","-moz-transition":"0.2s ease-out","-o-transition":"0.2s ease-out",transition:"0.2s ease-out"}),o.click(function(e){e.stopPropagation(),(e.target==e.currentTarget?back:n)()}),$jAlbum.each(t.objects,function(n,i){if(3>a)switch(i.category){case"image":var r=currentPath+t.path+"/"+i.thumb.path,s=getImageHTML("img-folder-"+a+"-"+e,jAlbumURL+r,!0);s.addClass("shadow"),s.addClass("imgRadius"),$jAlbum(window).on("clearUpContent",function(e){s.remove()}),!window.mobile&&window.hover&&s.hover(function(){o.css({"-webkit-transform":window.imgHoverScaleFactor,"-moz-transform":window.imgHoverScaleFactor,"-o-transform":window.imgHoverScaleFactor,transform:window.imgHoverScaleFactor})},function(){o.css({"-webkit-transform":"scale(1)","-moz-transform":"scale(1)","-o-transform":"scale(1)",transform:"scale(1)"})}),o.append(s),a++}}),0==a){var s="res/img/folder.png",c=getImageHTML("img-folder-1-"+e,jAlbumURL+s,!0);c.css("width","100%"),c.addClass("emptyFolderThumbnail"),$jAlbum(window).on("clearUpContent",function(e){c.remove()}),!window.mobile&&window.hover&&c.hover(function(){o.css({"-webkit-transform":window.imgHoverScaleFactor,"-moz-transform":window.imgHoverScaleFactor,"-o-transform":window.imgHoverScaleFactor,transform:window.imgHoverScaleFactor})},function(){o.css({"-webkit-transform":"scale(1)","-moz-transform":"scale(1)","-o-transform":"scale(1)",transform:"scale(1)"})}),o.append(c)}if(window.showFolderName){r.addClass("folderTitle");var l=folders[e].count?folders[e].count:0;r.append("<p>"+truncate(folders[e].name,window.maxLetters)+" ("+l+")</p>"),r.click(function(e){e.stopPropagation(),e.target==e.currentTarget&&n()}),i.append(r)}i.append(o),$jAlbum("#jAlbum-content").append(i),$jAlbum(window).on("clearUpContent",function(e){e.stopPropagation(),i.remove()})}function arrangeFolders(e,t){t=window.showFolderName?.7*t:.8*t,$jAlbum.each(folders,function(n,i){if(void 0!=i.width)for(var o=i.width,r=i.height,a=0;3>a;a++){var s=$jAlbum("#img-folder-"+a+"-"+i.index),c=-10*(a-1),l=-10*(a-1),m=0,d=0;s.css("transform","translate("+c+"px,"+l+"px)"),s.css("zIndex",20-a),o>=r?(m=t,d=r/(o/t)):(m=o/(r/t),d=t),s.css("width",m+"px"),s.css("height",d+"px"),window.showFolderName?(s.css("margin-top",(e-d)/1.35-window.imgBorderSize),s.css("margin-bottom","0px"),s.css("margin-left",(e-m)/2-window.imgBorderSize+"px"),s.css("margin-right",(e-m)/2-window.imgBorderSize+"px")):s.css("margin",(e-d)/2-window.imgBorderSize+"px "+((e-m)/2-window.imgBorderSize)+"px")}})}function initImage(e,t){var n=$jAlbum("<div>",{"class":"main-box"}),i=getImageHTML("img-thumb-"+e,jAlbumURL+currentPath+t.thumb.path,!1);i.css({"-webkit-transition":"0.2s ease-out","-moz-transition":"0.2s ease-out","-o-transition":"0.2s ease-out",transition:"0.2s ease-out"}),i.css("zIndex",5),i.addClass("shadow"),i.addClass("imgRadius"),i.addClass("img-box"),!window.mobile&&window.hover&&i.hover(function(){i.css("zIndex",10),i.css({"-webkit-transform":window.imgHoverScaleFactor,"-moz-transform":window.imgHoverScaleFactor,"-o-transform":window.imgHoverScaleFactor,transform:window.imgHoverScaleFactor})},function(){i.css("zIndex",5),i.css({"-webkit-transform":"scale(1)","-moz-transform":"scale(1)","-o-transform":"scale(1)",transform:"scale(1)"})}),n.click(function(t){t.stopPropagation(),t.target==t.currentTarget?back():fullscreen(e)}),n.append(i),$jAlbum("#jAlbum-content").append(n),$jAlbum(window).on("clearUpContent",function(e){n.remove()})}function arrangeImages(e,t){$jAlbum.each(thumbs,function(n,i){var o=i.width,r=i.height,a=0,s=0,c=$jAlbum("#img-thumb-"+i.index);o>=r?(a=t,s=t*r/o):(a=t*o/r,s=t),c.css("width",a+"px"),c.css("height",s+"px"),c.css("margin",(e-s)/2-window.imgBorderSize+"px "+((e-a)/2-window.imgBorderSize)+"px")})}function fullscreen(e){function t(){var t=slides.length,n=e+1;0>n?n+=t:n>=t&&(n-=t),a.remove(),o.remove(),$jAlbum("#fullscreen").css("display","none"),$jAlbum("#Embeddable").css("overflowY","visible"),$jAlbum("#Embeddable").css("height","auto"),tempSlideIndex=null,fullscreen(n)}function n(){var t=slides.length,n=e-1;0>n?n+=t:n>=t&&(n-=t),a.remove(),o.remove(),$jAlbum("#fullscreen").css("display","none"),$jAlbum("#Embeddable").css("overflowY","visible"),$jAlbum("#Embeddable").css("height","auto"),tempSlideIndex=null,fullscreen(n)}function i(){$jAlbum("#fullscreen").css("display","none"),$jAlbum("#Embeddable").css("overflowY","visible"),$jAlbum("#Embeddable").css("height","auto"),a.remove(),o.remove(),tempSlideIndex=null,arrange()}var o,r=(slides[e].width,slides[e].height,currentPath+slides[e].path),a=($jAlbum(window).width(),$jAlbum(window).height(),$jAlbum("<div/>")),s=$jAlbum("<div/>"),c=$jAlbum("#fullscreen");switch(tempSlideIndex=e,$jAlbum("#Embeddable").css("overflowY","hidden"),$jAlbum("#Embeddable").css("height","100%"),$jAlbum("#fullscreen").css("display","block"),a.addClass("fs_box"),s.addClass("cancel"),slides[e].category){case"image":o=getImageHTML("img-fullscreen-"+e,jAlbumURL+r,!1)}c.click(function(e){e.stopPropagation(),e.target==e.currentTarget&&i()}),s.click(function(e){e.stopPropagation(),e.target==e.currentTarget&&i()}),c.swipe({swipe:function(e,t){}}),a.swipe({tap:function(e,n){e.target==e.currentTarget&&t()},longTap:function(e,t){e.target==e.currentTarget&&i()},swipe:function(e,o,r,a,s,c){switch(o){case"left":e.target==e.currentTarget&&t();break;case"right":e.target==e.currentTarget&&n();break;case"up":e.target==e.currentTarget&&i();case"down":e.target==e.currentTarget&&i()}}}),$jAlbum(document).off().keyup(function(e){37==e.keyCode?t():39==e.keyCode||32==e.keyCode?n():(27==e.keyCode||8==e.keyCode)&&i()}),a.append(s),$jAlbum("#fullscreen").append(a),$jAlbum("#fullscreen").append(o),arrangeFullscreen()}function arrangeFullscreen(){if(null!==tempSlideIndex){var e=slides[tempSlideIndex].width,t=slides[tempSlideIndex].height,n=$jAlbum(window).width(),i=$jAlbum(window).height(),o=0,r=0,a=$jAlbum("#fullscreen img"),s=$jAlbum(".fs_box");n/i>=e/t?(o=e/(t/i),r=i,a.css("margin","0px "+(n-o)/2+"px"),s.css("margin","0px "+(n-o)/2+"px")):(o=n,r=t/(e/n),a.css("margin",(i-r)/2+"px 0px"),s.css("margin",(i-r)/2+"px 0px")),a.css("height",r),a.css("width",o),s.css("height",r),s.css("width",o)}}window.mobile=isMobile();var currentPath="",$jAlbum=jQuery.noConflict(!0),currentImgBoxPadding=window.mobile?15:25,currentContentPadding=window.mobile?15:35,currentBoxSize=window.mobile?window.imgBoxSize-25:window.imgBoxSize;window.maxLetters=0,function(e){var t=e.imgBoxSize/25*2+(16-e.textSize)+2;e.maxLetters=t}(this);var thumbs=new Array,slides=new Array,folders=new Array;""==currentPath&&$jAlbum(".leaveFolder").hide(),$jAlbum(document).ready(function(){$jAlbum(".ui-loader").hide()}),window.credits||$jAlbum("#jAlbum-footer .center").hide(),$jAlbum("#Embeddable, .jAlbum #jAlbum-footer, .jAlbum #jAlbum-footer .center, .jAlbum #jAlbum-footer .left, .jAlbum #jAlbum-footer p, .jAlbum #jAlbum-content, .jAlbum #print").click(function(e){e.target==e.currentTarget&&back()}),window.onresize=function(){arrange(),arrangeFullscreen()};var tempSlideIndex=null;initContent(window.album);